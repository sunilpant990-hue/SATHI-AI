<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sathi AI â€” Student Support (Sunil Pant)</title>
<link rel="icon" href="https://i.ibb.co/6XJ5sBX/robot-logo.png">

<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#00d2b0;
    --muted:#9aa4b2;
    --text:#e6eef6;
    --user:#0b63ff;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;
    background:linear-gradient(180deg,#071026 0%, #081220 100%);
    color:var(--text);
    padding:20px;
  }

  /* Main card */
  .app {
    width:990px;
    max-width:100%;
    display:flex;
    gap:24px;
  }

  /* Left: Info */
  .panel {
    width:360px;
    background:var(--card);
    border-radius:12px;
    padding:18px;
    box-shadow:0 10px 30px rgba(3,6,18,0.6);
  }
  .brand {
    display:flex;
    gap:12px;
    align-items:center;
  }
  .brand img{width:64px;height:64px;border-radius:10px}
  .brand h2{margin:0;font-size:18px}
  .brand p{margin:0;color:var(--muted);font-size:13px}
  .founder{margin-top:10px;color:var(--muted);font-size:13px}

  .about{margin-top:14px;color:#cfeff2;font-size:14px;line-height:1.45}
  .hint{margin-top:12px;color:var(--muted);font-size:13px}

  .small-controls{display:flex;gap:8px;margin-top:14px}
  .btn{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);cursor:pointer;background:transparent;color:var(--text);font-weight:600}
  .btn.primary{background:linear-gradient(90deg,var(--accent),#00a68a); color:#021016; border:0}
  .btn.warn{background:#ff4d6d;color:white;border:0}

  /* Right: Chat window */
  .chat-wrap{
    flex:1;
    display:flex;
    flex-direction:column;
    min-height:520px;
    max-height:calc(100vh - 80px);
  }
  .chat-top{
    background:var(--card);
    padding:14px 16px;
    border-radius:12px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 8px 24px rgba(3,6,18,0.6);
  }
  .chat-top .title{font-size:16px;font-weight:700}
  .chat-top .sub{color:var(--muted);font-size:13px}

  .chat {
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    margin-top:12px;
    border-radius:12px;
    padding:16px;
    display:flex;
    flex-direction:column;
    gap:12px;
    height:420px;
    overflow:auto;
  }

  .msg {
    display:inline-block;
    padding:10px 12px;
    border-radius:10px;
    max-width:78%;
    line-height:1.3;
    font-size:14px;
    position:relative;
  }
  .meta {display:block;font-size:11px;color:var(--muted);margin-top:8px}

  .msg.bot {
    background:rgba(255,255,255,0.03);
    color:var(--text);
    border-left:3px solid rgba(255,255,255,0.02);
    align-self:flex-start;
    box-shadow: 0 6px 20px rgba(2,6,10,0.4);
  }

  .msg.user {
    background:linear-gradient(90deg,var(--user),#0066ff);
    color:white;
    align-self:flex-end;
    box-shadow: 0 6px 18px rgba(3,12,60,0.35);
  }

  /* Typing indicator */
  .typing {
    display:flex;
    gap:6px;
    align-items:center;
    padding:8px 12px;
    border-radius:10px;
    background:rgba(255,255,255,0.02);
    width:fit-content;
  }
  .dot{width:8px;height:8px;border-radius:50%;background:var(--muted);opacity:0.8;animation:blink 1s infinite}
  .dot.d1{animation-delay:0s}.dot.d2{animation-delay:.15s}.dot.d3{animation-delay:.3s}
  @keyframes blink{0%{opacity:.15}50%{opacity:1}100%{opacity:.15}}

  /* Input area */
  .controls{
    display:flex;
    gap:8px;
    margin-top:12px;
    align-items:center;
  }
  .input {
    flex:1;
    display:flex;
    gap:8px;
    align-items:center;
    background:var(--card);
    padding:8px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,0.02);
  }
  .input input{
    width:100%;
    border:0;
    background:transparent;
    outline:none;
    color:var(--text);
    font-size:14px;
    padding:8px;
  }
  .icon {
    width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.02);
  }

  .small {font-size:12px;color:var(--muted);margin-top:8px;text-align:right}

  /* responsive */
  @media (max-width:980px){ .app{flex-direction:column;align-items:center} .panel{width:100%;max-width:420px} .chat-wrap{width:100%}}
</style>
</head>
<body>

<div class="app">

  <!-- Left panel (project info) -->
  <div class="panel">
    <div class="brand">
      <img src="https://i.ibb.co/6XJ5sBX/robot-logo.png" alt="Sathi AI logo">
      <div>
        <h2>Sathi AI (à¤¸à¤¾à¤¥à¥€ AI)</h2>
        <p class="muted">Study & mental support chatbot â€” Bilingual</p>
      </div>
    </div>

    <div class="founder">Created by <strong>Sunil Pant</strong></div>

    <div class="about">
      Sathi AI helps Nepali students with exam stress, confidence, time management, sleep tips and simple study strategies â€” in English & Nepali. Designed to be anonymous and educational. Not a replacement for professional counseling.
    </div>

    <div class="hint">Quick actions:</div>
    <div class="small-controls">
      <button class="btn primary" id="saveBtn">Save Chat</button>
      <button class="btn" id="downloadBtn">Download</button>
      <button class="btn" id="copyBtn">Copy</button>
    </div>

    <div style="margin-top:12px">
      <button class="btn" id="restoreBtn">Restore Last Saved</button>
      <button class="btn warn" id="clearLocalBtn">Delete Saved</button>
    </div>

    <div class="hint">Mic & Hosting:</div>
    <div style="font-size:13px;color:var(--muted);line-height:1.4;margin-top:6px">
      â€¢ Microphone needs a secure context (HTTPS) in many browsers. If mic doesn't work locally, publish to GitHub Pages (free) â€” instructions below. <br>
      â€¢ Chat is saved locally in your browser for proof.
    </div>
  </div>

  <!-- Right: Chat -->
  <div class="chat-wrap">
    <div class="chat-top">
      <div>
        <div class="title">Sathi AI â€” Study & Mental Support</div>
        <div class="sub">Bilingual â€¢ Anonymous â€¢ Founder: Sunil Pant</div>
      </div>
      <div style="text-align:right;color:var(--muted);font-size:12px">Status: <span id="micStatus">Mic: checkingâ€¦</span></div>
    </div>

    <div id="chat" class="chat" aria-live="polite"></div>

    <div class="controls">
      <div class="input">
        <input id="user" type="text" placeholder="Type question or try: 'exam', 'pressure', 'nindra audaina', 'solve 3+5'..." />
      </div>
      <div class="icon" id="micBtn" title="Start/Stop microphone">ðŸŽ¤</div>
      <div class="icon" id="sendBtn" title="Send message">âž¤</div>
    </div>

    <div class="small">Tip: If mic doesn't work, you can still type. To host free: GitHub Pages (I can help).</div>
  </div>

</div>

<script>
/* === Utility & state === */
const chatEl = document.getElementById('chat');
const inputEl = document.getElementById('user');
const sendBtn = document.getElementById('sendBtn');
const micBtn = document.getElementById('micBtn');
const saveBtn = document.getElementById('saveBtn');
const downloadBtn = document.getElementById('downloadBtn');
const copyBtn = document.getElementById('copyBtn');
const restoreBtn = document.getElementById('restoreBtn');
const clearLocalBtn = document.getElementById('clearLocalBtn');
const micStatus = document.getElementById('micStatus');

let recognition = null;
let listening = false;

function nowStamp(){ return new Date().toLocaleString(); }

function addMessage(text, who='bot', opts={showMeta:true}) {
  const d = document.createElement('div');
  d.className = 'msg ' + (who==='user' ? 'user' : 'bot');

  // allow newlines
  const safe = text.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
  d.innerHTML = safe + (opts.showMeta ? `<span class="meta">${who==='user' ? 'You' : 'Sathi AI'} â€¢ ${nowStamp()}</span>` : '');
  chatEl.appendChild(d);
  chatEl.scrollTop = chatEl.scrollHeight;
}

/* Typing indicator */
function showTyping(duration=700){
  const t = document.createElement('div');
  t.className = 'typing';
  t.innerHTML = '<div class="dot d1"></div><div class="dot d2"></div><div class="dot d3"></div>';
  chatEl.appendChild(t);
  chatEl.scrollTop = chatEl.scrollHeight;
  return t;
}

/* Clear typing */
function removeElem(el){ if(el && el.parentNode) el.parentNode.removeChild(el); }

/* === Bot brain === */
/* Arrays for jokes, facts, motivational quotes */
const JOKES = [
  "Why did the programmer quit his job? Because he didn't get arrays (a raise)!",
  "I told my computer I needed a break, and it said: 'No problem â€” I'll go to sleep.'"
];
const FACTS = [
  "Nepal's internet & mobile usage is growing fast â€” small digital projects reach many students.",
  "Practice testing (doing past papers) is one of the best ways to improve exam scores."
];
const MOTIV = [
  "Small daily progress compounds. Do one small thing today and repeat tomorrow.",
  "Failure is feedback â€” learn one thing and try again. You are capable."
];

/* Detect intent */
function detectIntent(text){
  const t = text.toLowerCase();

  // Crisis detection
  const crisis = ["suicide","kill myself","i want to die","end my life","self harm","suicidal",
    "marna","ma marna","aafai marne","aafnai marne","aafai marrne"];
  for(const k of crisis) if(t.includes(k)) return {int:'crisis',lang: /[\u0900-\u097F]/.test(k) ? 'np':'en'};

  // math solver pattern: starts with "solve" or "calculate" or "solve 3+2"
  if(t.startsWith('solve ') || t.startsWith('calculate ') || /^[-\d\.\s\+\*\/\(\)]+$/.test(t) || t.startsWith('solve:') ) {
    // We'll try to extract expression
    const expr = t.replace(/^(solve|calculate|solve:)\s*/,'').trim();
    if(expr.length>0) return {int:'math', expr};
  }
  // english keywords
  if(/\b(exam|test|finals|board)\b/.test(t)) return {int:'exam'};
  if(/\b(stress|stressed|pressure|overwhelmed|anxiety)\b/.test(t)) return {int:'pressure'};
  if(/\b(sleep|insomnia|nindra|nindra audaina|sutana)\b/.test(t)) return {int:'sleep'};
  if(/\b(confidence|confident|doubt|bharosa|confidence kam)\b/.test(t)) return {int:'confidence'};
  if(/\b(lonely|alone|eklo|ekla)\b/.test(t)) return {int:'lonely'};
  if(/\b(motivate|motivation|inspire)\b/.test(t)) return {int:'motivate'};
  if(/\b(joke|jokes)\b/.test(t)) return {int:'joke'};
  if(/\b(fact|facts)\b/.test(t)) return {int:'fact'};
  if(/\b(time|date|what time|today)\b/.test(t)) return {int:'time'};
  if(/\b(weather|rain|snow|temperature)\b/.test(t)) return {int:'weather'};
  if(/\b(who are you|who r you|who you)\b/.test(t)) return {int:'who'};
  if(/\b(hi|hello|namaste|hey)\b/.test(t)) return {int:'greet'};
  if(/\b(college|admission|apply|sat|application)\b/.test(t)) return {int:'college'};
  // fallback
  return {int:'fallback'};
}

/* Safe math evaluation (only digits and operators) */
function safeEval(expr){
  // allow only numbers, spaces and + - * / ( ) . characters
  if(!/^[0-9\.\s\+\-\*\/\(\)]+$/.test(expr)) return {err:'Expression contains invalid characters.'};
  try{
    // eslint-disable-next-line no-eval
    const result = Function('"use strict"; return (' + expr + ')')();
    if(result === Infinity || isNaN(result)) return {err:'Invalid result.'};
    return {val: result};
  }catch(e){ return {err:'Cannot evaluate expression.'}; }
}

/* Generate reply (main) */
function generateReply(text){
  const d = detectIntent(text);

  if(d.int === 'crisis'){
    const msg = "If you are thinking about harming yourself, please contact local emergency services now and reach out to a trusted adult. You are not alone.";
    return {text: msg, urgent:true};
  }
  if(d.int === 'math'){
    const res = safeEval(d.expr || text);
    if(res.err) return {text: "I couldn't solve that: " + res.err};
    return {text: `Answer: ${res.val}`};
  }
  if(d.int === 'exam'){
    return {text: "Exams are stressful. Try 25-minute focused sessions (Pomodoro), active recall, and timed past-paper practice."};
  }
  if(d.int === 'pressure'){
    return {text: "Pressure from family or studies is common. Try talking to one trusted person and break tasks into small steps."};
  }
  if(d.int === 'sleep'){
    return {text: "Improve sleep: avoid screens 30 minutes before bed, keep a regular schedule, and try 4-4-4 breathing before sleep."};
  }
  if(d.int === 'confidence'){
    return {text: "Lack of confidence doesn't equal lack of ability. List 3 small wins you had this week â€” celebrate them."};
  }
  if(d.int === 'lonely'){
    return {text: "You're not alone. Consider joining a study group or telling a friend or teacher how you feel."};
  }
  if(d.int === 'motivate'){
    return {text: MOTIV[Math.floor(Math.random()*MOTIV.length)]};
  }
  if(d.int === 'joke'){
    return {text: JOKES[Math.floor(Math.random()*JOKES.length)]};
  }
  if(d.int === 'fact'){
    return {text: FACTS[Math.floor(Math.random()*FACTS.length)]};
  }
  if(d.int === 'time'){
    return {text: "Current time: " + new Date().toLocaleString()};
  }
  if(d.int === 'weather'){
    return {text: "Weather check: I can't access live weather offline, but generally carry a light jacket during monsoon season in Nepal."};
  }
  if(d.int === 'who'){
    return {text: "I'm Sathi AI â€” a student support chatbot built by Sunil Pant. I provide study tips and mental-health suggestions in Nepali & English."};
  }
  if(d.int === 'greet'){
    return {text: "Namaste! I'm Sathi AI. How are you feeling today?"};
  }
  if(d.int === 'college'){
    return {text: "For college apps: show impact, leadership, code (GitHub), and a small demo video. I can help you draft a 1-paragraph activity description."};
  }
  // fallback: try to respond with basic empathy + ask for clarification
  return {text: "Thanks for sharing. Could you tell me a little more? (Or try keywords: exam, pressure, nindra audaina, solve 3+5)"};
}

/* === Send flow (handles typing animation) === */
function userSend(text){
  if(!text || !text.trim()) return;
  addMessage(text, 'user');
  // show typing
  const t = showTyping();
  setTimeout(()=> {
    removeElem(t);
    const bot = generateReply(text);
    addMessage(bot.text || "Sorry I couldn't respond.", 'bot');
    if(bot.urgent) setTimeout(()=> alert(bot.text), 200);
  }, 700 + Math.min(700, text.length*10) );
}

/* === Buttons & keyboard === */
sendBtn.addEventListener('click', ()=>{ userSend(inputEl.value); inputEl.value=''; inputEl.focus(); });
inputEl.addEventListener('keypress', (e)=>{ if(e.key==='Enter'){ userSend(inputEl.value); inputEl.value=''; }} );

/* === Mic setup === */
function setupMic(){
  micStatus.innerText = "Mic: checkingâ€¦";
  if(!('SpeechRecognition' in window) && !('webkitSpeechRecognition' in window)){
    micStatus.innerText = "Mic: not supported in this browser";
    micBtn.title = "Mic not supported";
    micBtn.style.opacity = 0.6;
    return;
  }
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SR();
  recognition.lang = 'en-IN'; // accepts English; Nepali phrases may be recognized OK in some browsers
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.onstart = ()=>{ listening=true; micStatus.innerText = "Mic: listeningâ€¦ (click to stop)"; micBtn.style.background = '#0b3a3a'; }
  recognition.onend = ()=>{ listening=false; micStatus.innerText = "Mic: idle"; micBtn.style.background = ''; }
  recognition.onerror = (e)=>{ console.warn('mic error', e); micStatus.innerText = "Mic: error"; alert("Microphone error: " + (e.error||'unknown')); }

  recognition.onresult = (ev) => {
    const text = ev.results[0][0].transcript;
    inputEl.value = text;
    userSend(text);
    inputEl.value='';
  };

  micStatus.innerText = "Mic: ready (click mic)";
}

/* mic button toggle */
micBtn.addEventListener('click', ()=>{
  if(!recognition){ alert("Microphone not supported in this browser. Use Chrome/Brave or host the page over HTTPS."); return; }
  if(!listening){ try{ recognition.start(); }catch(e){ console.warn(e); } }
  else { recognition.stop(); }
});

/* === Local storage / Save / Download / Copy === */
function saveChat(){
  const html = chatEl.innerHTML;
  localStorage.setItem('sathi_chat_v1', html);
  alert('Chat saved locally (browser storage).');
}
function restoreChat(){
  const html = localStorage.getItem('sathi_chat_v1');
  if(html){ chatEl.innerHTML = html; chatEl.scrollTop = chatEl.scrollHeight; alert('Chat restored.'); }
  else alert('No saved chat found.');
}
function clearSaved(){
  localStorage.removeItem('sathi_chat_v1');
  alert('Saved chat deleted.');
}
function downloadChat(){
  const text = Array.from(chatEl.querySelectorAll('.msg')).map(m => m.innerText.replace(/\n/g,' ')).join('\n\n');
  const file = new Blob([text], {type:'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(file);
  a.download = 'sathi_ai_chat.txt';
  a.click();
}
function copyChat(){
  const text = Array.from(chatEl.querySelectorAll('.msg')).map(m => m.innerText.replace(/\n/g,' ')).join('\n\n');
  navigator.clipboard.writeText(text).then(()=> alert('Chat copied to clipboard.'));
}

/* attach buttons */
saveBtn.addEventListener('click', saveChat);
restoreBtn.addEventListener('click', restoreChat);
clearLocalBtn.addEventListener('click', ()=>{ if(confirm('Delete saved chat?')) clearSaved(); });
downloadBtn.addEventListener('click', downloadChat);
copyBtn.addEventListener('click', copyChat);

/* init */
setupMic();

// Initial welcome
setTimeout(()=>{ addMessage("Namaste! I'm Sathi AI â€” your study & mental support buddy in Nepal. Try: 'exam', 'pressure', 'nindra audaina', or 'solve 3+5'. Your chat will be saved in the browser for proof.", 'bot') }, 300);

/* restore on load if exists */
document.addEventListener('DOMContentLoaded', ()=>{ const h = localStorage.getItem('sathi_chat_v1'); if(h) { /*keep empty until user restores*/ } });

</script>

</body>
</html>
